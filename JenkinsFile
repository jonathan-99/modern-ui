pipeline {
    agent any

    stages {
        stage('checks') {
            steps {
                script {
                sh """
                    echo "this is the npm version ${sh(script: 'npm -v', returnStdout: true).trim()}"
                    echo "this is the npm version ${sh(script: 'node -v', returnStdout: true).trim()}"
                    echo "this is the ufw data ${sh(script: 'sudo ufw status', returnStdout: true).trim()}"
                    echo "docker version ${sh(script: 'docker -v', returnStdout: true).trim()}"
                    echo "typscript version ${sh(script: 'tsc -v', returnStdout: true).trim()}"
                """
                }
            }
        }
        stage('Clone Repository') {
            steps {
                script {
                    //def gitRepoUrl = 'https://github.com/jonathan-99/modern-ui.git'
                    //def repoDir = "${WORKSPACE}/repository"
                    //echo "Cloning repository from $gitRepoUrl to $repoDir..."
                    //sh "git clone $gitRepoUrl $repoDir"
                    //sh "git update-index --chmod=+x $repoDir/jenkins/startup-and-install.sh"
                    echo "here"
                }
            }
        }
        stage('Change permissions') {
            steps {
                script {
                sh """
                    filePermissions1=\$(ls -l jenkins/startup-and-install.sh)
                    echo 'File permissions: \$filePermissions1'
                    chmod +x jenkins/startup-and-install.sh
                    thefile = $(/jenkins/startup-and-install.sh)
                    script -q -c './$thefile' /dev/null

                    filePermissions2=\$(ls -l jenkins/download-and-run-app.sh)
                    echo 'File permissions: \$filePermissions2'
                    chmod +x jenkins/download-and-run-app.sh
                    ./jenkins/download-and-run-app.sh

                    filePermissions3=\$(ls -l jenkins/unittests_and_coverage_report.sh)
                    echo 'File permissions: \$filePermissions3'
                    chmod +x jenkins/unittests_and_coverage_report.sh
                    ./jenkins/unittests_and_coverage_report.sh
                """
                }
            }
        }
        stage('Start up and install') {
            steps {
                script {
                    sh """
                    file='jenkins/startup-and-install.sh'
                    chmod +x \$file
                    filePermissions=\$(ls -l \$file)
                    echo 'File permissions: \$filePermissions'
                    script -q -c "./$file" /dev/null
                    """
                }
            }
        }
        stage('download and run the app') {
            steps {
                script {
                    sh """
                    file='jenkins/download-and-run-app.sh'
                    chmod +x \$file
                    filePermissions=\$(ls -l \$file)
                    echo 'File permissions: \$filePermissions'
                    ./\$file
                    """
                }
            }
        }
        stage('unittests and coverage report') {
            steps {
                script {
                    sh """
                    file='jenkins/unittests_and_coverage_report.sh'
                    chmod +x \$file
                    filePermissions=\$(ls -l \$file)
                    echo 'File permissions: \$filePermissions'
                    ./\$file
                    """
                }
            }
        }
        stage('Cypress checks') {
            steps {
                script {
                    sh """
                    file='jenkins/install_and_do_Cypress_test.sh'
                    chmod +x \$file
                    filePermissions=\$(ls -l \$file)
                    echo 'File permissions: \$filePermissions'
                    ./\$file
                    """
                }
            }
        }
    }
}
