pipeline {
    agent any

    stages {
        stage('checks') {
            steps {
                script {
                echo "this is the npm version $(sh(script: 'npm -v', returnStdout: true).trim())"
                echo "this is the npm version $(sh(script: 'node -v', returnStdout: true).trim())"
                echo "this is the ufw data $(sh(script: 'ufw status', returnStdout: true).trim()"
                echo "docker version $(sh(script: 'docker -v', returnStdout: true).trim()"
                echo"typscript version $(sh(script: 'tsc -v', returnStdout: true).trim()"
                }
            }
        }
        stage('Clone Repository') {
            steps {
                script {
                    //def gitRepoUrl = 'https://github.com/jonathan-99/modern-ui.git'
                    //def repoDir = "${WORKSPACE}/repository"
                    //echo "Cloning repository from $gitRepoUrl to $repoDir..."
                    //sh "git clone $gitRepoUrl $repoDir"
                    //sh "git update-index --chmod=+x $repoDir/jenkins/startup-and-install.sh"
                    echo "here"
                }
            }
        }
        stage('Change permissions') {
            steps {
                script {
                    sh """
                    file_1='jenkins/startup-and-install.sh'
                    chmod +x \$file_1
                    filePermissions=\$(ls -l \$file_1)
                    echo 'File permissions: \$filePermissions'

                    file_2='jenkins/download-and-run-app.sh'
                    chmod +x \$file_2
                    filePermissions=\$(ls -l \$file_2)
                    echo 'File permissions: \$filePermissions'

                    file_3='jenkins/unittests_and_coverage_report.sh'
                    chmod +x \$file_3
                    filePermissions=\$(ls -l \$file_3)
                    echo 'File permissions: \$filePermissions'
                    """

                }
            }
        }
        stage('Start up and install') {
            steps {
                script {
                    sh """
                    file='jenkins/startup-and-install.sh'
                    chmod +x \$file
                    filePermissions=\$(ls -l \$file)
                    echo 'File permissions: \$filePermissions'
                    ./\$file
                    """
                }
            }
        }
        stage('download and run the app') {
            steps {
                script {
                    sh """
                    file='jenkins/download-and-run-app.sh'
                    chmod +x \$file
                    filePermissions=\$(ls -l \$file)
                    echo 'File permissions: \$filePermissions'
                    ./\$file
                    """
                }
            }
        }
        stage('unittests and coverage report') {
            steps {
                script {
                    sh """
                    file='jenkins/unittests_and_coverage_report.sh'
                    chmod +x \$file
                    filePermissions=\$(ls -l \$file)
                    echo 'File permissions: \$filePermissions'
                    ./\$file
                    """
                }
            }
        }
        stage('Cypress checks') {
            steps {
                script {
                    sh """
                    file='jenkins/install_and_do_Cypress_test.sh'
                    chmod +x \$file
                    filePermissions=\$(ls -l \$file)
                    echo 'File permissions: \$filePermissions'
                    ./\$file
                    """
                }
            }
        }
    }
}
